<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å Easy ‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { kanit: ['Kanit','sans-serif'] }
        }
      }
    }
  </script>
</head>
<body class="bg-gradient-to-br from-orange-50 to-red-50 min-h-screen font-kanit">

  <!-- Branch Selection Screen -->
  <div id="branchScreen" class="min-h-screen flex flex-col">
    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 text-center">
      <h1 class="text-2xl font-bold mb-2">üçú Easy ‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å</h1>
      <p class="text-orange-100">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å</p>
    </div>

    <div class="flex-1 p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</h2>
      <div class="space-y-4">
        <button onclick="selectBranch('‡∏≠‡∏°‡∏ï‡∏∞')" class="w-full bg-white rounded-xl p-4 shadow-lg border-2 border-transparent hover:border-orange-300 transition-all duration-200 active:scale-95">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mr-4">
                <span class="text-2xl">üè¢</span>
              </div>
              <div class="text-left">
                <h3 class="font-semibold text-gray-800">‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏°‡∏ï‡∏∞</h3>
                <p class="text-sm text-gray-500">Amata Branch</p>
              </div>
            </div>
            <span class="text-orange-500 text-xl">‚Üí</span>
          </div>
        </button>

        <button onclick="selectBranch('‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏™‡∏±‡∏à‡∏à‡∏≤')" class="w-full bg-white rounded-xl p-4 shadow-lg border-2 border-transparent hover:border-orange-300 transition-all duration-200 active:scale-95">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                <span class="text-2xl">üè™</span>
              </div>
              <div class="text-left">
                <h3 class="font-semibold text-gray-800">‡∏™‡∏≤‡∏Ç‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏™‡∏±‡∏à‡∏à‡∏≤</h3>
                <p class="text-sm text-gray-500">Prayasatcha Branch</p>
              </div>
            </div>
            <span class="text-orange-500 text-xl">‚Üí</span>
          </div>
        </button>

        <button onclick="selectBranch('‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô')" class="w-full bg-white rounded-xl p-4 shadow-lg border-2 border-transparent hover:border-orange-300 transition-all duration-200 active:scale-95">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                <span class="text-2xl">üèñÔ∏è</span>
              </div>
              <div class="text-left">
                <h3 class="font-semibold text-gray-800">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô</h3>
                <p class="text-sm text-gray-500">Bangsaen Branch</p>
              </div>
            </div>
            <span class="text-orange-500 text-xl">‚Üí</span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Mode Selection Screen -->
  <div id="modeScreen" class="min-h-screen flex flex-col hidden">
    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 text-center relative">
      <button onclick="goBack('branchScreen')" class="absolute left-4 top-6 text-white text-xl">‚Üê</button>
      <h1 class="text-xl font-bold mb-1">‡∏™‡∏≤‡∏Ç‡∏≤ <span id="selectedBranch"></span></h1>
      <p class="text-orange-100">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
    </div>

    <div class="flex-1 p-6">
      <div class="space-y-6">
        <button onclick="selectMode('open')" class="w-full bg-gradient-to-r from-green-400 to-green-500 text-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95">
          <div class="text-center">
            <div class="text-4xl mb-3">üîì</div>
            <h3 class="text-xl font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</h3>
          </div>
        </button>

        <button onclick="selectMode('close')" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95">
          <div class="text-center">
            <div class="text-4xl mb-3">üåô</div>
            <h3 class="text-xl font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Ñ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</h3>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Stock Check Screen -->
  <div id="stockScreen" class="min-h-screen flex flex-col hidden">
    <!-- Header with Progress -->
    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-4">
      <button onclick="goBack('modeScreen')" class="text-white text-xl mb-2">‚Üê</button>
      <div class="flex justify-between items-center mb-3">
        <div>
          <h1 class="text-lg font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å</h1>
          <p class="text-orange-100 text-sm"><span id="modeText"></span></p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold" id="progressText">0%</div>
          <div class="text-xs text-orange-100">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
        </div>
      </div>
      <div class="w-full bg-orange-300 rounded-full h-3">
        <div id="progressBar" class="bg-white h-3 rounded-full transition-all duration-300" style="width:0%"></div>
      </div>
    </div>

    <!-- Stock Items -->
    <div class="flex-1 p-4 pb-24" id="stockItems"></div>

    <!-- Save Button -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200">
      <button onclick="saveStock()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95">
        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
      </button>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full">
      <div class="text-center">
        <div class="text-4xl mb-4">‚ùì</div>
        <h3 class="text-lg font-semibold mb-2">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?</h3>
        <p class="text-gray-600 text-sm mb-6" id="confirmItemName"></p>
        <div class="flex space-x-3">
          <button onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-medium">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button onclick="confirmOrder()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-medium">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Summary Screen -->
  <div id="summaryScreen" class="min-h-screen flex flex-col hidden">
    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-4">
      <button onclick="goBack('stockScreen')" class="text-white text-xl mb-2">‚Üê</button>
      <div class="text-center">
        <h1 class="text-lg font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</h1>
        <p class="text-orange-100 text-sm">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
      </div>
    </div>

    <div class="flex-1 p-4 pb-24">
      <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 mb-4">
        <div class="flex items-center mb-3">
          <span class="text-2xl mr-2">üìã</span>
          <h3 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</h3>
        </div>
        <div id="orderSummaryList"></div>
      </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200">
      <button onclick="confirmSaveStock()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95">
        ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      </button>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full">
      <div class="text-center">
        <div class="text-4xl mb-4">‚úÖ</div>
        <h3 class="text-lg font-semibold mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
        <p class="text-gray-600 text-sm mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>
        <button onclick="resetApp()" class="w-full bg-orange-500 text-white py-3 rounded-lg font-medium">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      </div>
    </div>
  </div>

  <script>
    let currentBranch = '';
    let currentMode = '';
    let stockData = {};
    let orderRequests = {};
    let currentConfirmItem = '';
    let customOrders = [];

    // ---------- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ----------
    const openModeItems = [
      { name: '‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà', unit: '‡∏´‡πà‡∏≠', category: 'main' },                // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏≠‡∏Å‡πÑ‡∏Å‡πà', unit: '‡∏Å‡∏¥‡πÇ‡∏•', category: 'main' },                  // ‡∏Å‡∏¥‡πÇ‡∏•
      { name: '‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏à‡∏Å', unit: '‡∏ñ‡∏∏‡∏á', category: 'main' },                // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°', unit: '‡∏Å‡∏¥‡πÇ‡∏•', category: 'main' },             // ‡∏Å‡∏¥‡πÇ‡∏•
      { name: '‡∏Å‡∏•‡πà‡∏≠‡∏á 26 oz', unit: '‡πÅ‡∏ñ‡∏ß', category: 'main' },            // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏Å‡∏•‡πà‡∏≠‡∏á 32 oz', unit: '‡πÅ‡∏ñ‡∏ß', category: 'main' },            // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡πÇ‡∏Ñ‡πâ‡∏Å', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏™‡πÑ‡∏õ‡∏£‡πå‡∏ó', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏ô‡πâ‡∏≥‡πÅ‡∏î‡∏á', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡πÄ‡∏Å‡πä‡∏Å‡∏Æ‡∏ß‡∏¢', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' },
      { name: '‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏•‡∏¥', unit: '‡∏Ç‡∏ß‡∏î', category: 'main' }
    ];

    const closeModeItems = [
      // ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏™‡∏î
      { name: '‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà', unit: '‡∏´‡πà‡∏≠', category: 'fresh', icon:'ü•¨' },    // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏≠‡∏Å‡πÑ‡∏Å‡πà', unit: '‡∏Å‡∏¥‡πÇ‡∏•', category: 'fresh', icon:'ü•¨' },
      { name: '‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏à‡∏Å', unit: '‡∏ñ‡∏∏‡∏á', category: 'fresh', icon:'ü•¨' },    // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°', unit: '‡∏Å‡∏¥‡πÇ‡∏•', category: 'fresh', icon:'ü•¨' },
      { name: '‡πÉ‡∏ö‡∏û‡∏≤‡∏™‡πÄ‡∏•‡πà‡∏¢‡πå', unit: '‡∏ñ‡∏∏‡∏á', category: 'fresh', icon:'ü•¨' },  // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤', unit: '', category: 'fresh', icon:'ü•¨', orderOnly:true },
      { name: '‡πÑ‡∏Ç‡πà‡∏Å‡∏∏‡πâ‡∏á', unit: '', category: 'fresh', icon:'ü•¨', orderOnly:true },

      // ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á
      { name: '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡πÄ‡∏à‡∏µ‡∏¢‡∏ß', unit: '‡πÅ‡∏Å‡∏•‡∏•‡∏≠‡∏ô', category: 'seasoning', icon:'üßÇ' }, // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡πÄ‡∏à‡∏µ‡∏¢‡∏ß', unit: '‡∏Å‡∏£‡∏±‡∏°', category: 'seasoning', icon:'üßÇ' },
      { name: '‡∏ã‡∏≠‡∏™‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°', unit: '‡πÅ‡∏Å‡∏•‡∏•‡∏≠‡∏ô', category: 'seasoning', icon:'üßÇ' },           // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ

      // ‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
      { name: '‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏ô‡∏≤‡∏ß', unit: '', category: 'seasoning', icon:'üßÇ', orderOnly:true },
      { name: '‡∏û‡∏£‡∏¥‡∏Å‡∏õ‡πà‡∏ô', unit: '', category: 'seasoning', icon:'üßÇ', orderOnly:true },
      { name: '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•', unit: '', category: 'seasoning', icon:'üßÇ', orderOnly:true },
      { name: '‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤', unit: '', category: 'seasoning', icon:'üßÇ', orderOnly:true },
      { name: '‡∏£‡∏™‡∏î‡∏µ', unit: '', category: 'seasoning', icon:'üßÇ', orderOnly:true },

      // ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå + ‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°/‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°
      { name: '‡∏ñ‡∏∏‡∏á‡∏ã‡∏µ‡∏• 7√ó10', unit: '‡∏´‡πà‡∏≠', category: 'packaging', icon:'üì¶' },             // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏ñ‡∏∏‡∏á‡∏ã‡∏µ‡∏• 9√ó11.5', unit: '‡∏´‡πà‡∏≠', category: 'packaging', icon:'üì¶' },           // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏Å‡∏•‡πà‡∏≠‡∏á 26 oz', unit: '‡πÅ‡∏ñ‡∏ß', category: 'packaging', icon:'üì¶' },            // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏Å‡∏•‡πà‡∏≠‡∏á 32 oz', unit: '‡πÅ‡∏ñ‡∏ß', category: 'packaging', icon:'üì¶' },            // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏ñ‡∏∏‡∏á‡∏´‡∏¥‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å 6√ó14', unit: '‡∏´‡πà‡∏≠', category: 'packaging', icon:'üì¶' },    // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏ñ‡∏∏‡∏á‡∏´‡∏¥‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å 8√ó16', unit: '‡∏´‡πà‡∏≠', category: 'packaging', icon:'üì¶' },    // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°', unit: '‡πÅ‡∏ú‡πà‡∏ô', category: 'packaging', icon:'üì¶' },   // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ
      { name: '‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡πÅ‡∏ã‡πà‡∏ö', unit: '‡πÅ‡∏ú‡πà‡∏ô', category: 'packaging', icon:'üì¶' },       // ‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ

      { name: '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡πÇ‡∏Ñ‡πâ‡∏Å', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡πÅ‡∏î‡∏á', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡∏™‡πÑ‡∏õ‡∏£‡πå‡∏ó', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡πä‡∏Å‡∏Æ‡∏ß‡∏¢', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },
      { name: '‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢', unit: '‡∏Ç‡∏ß‡∏î', category: 'packaging', icon:'üì¶' },

      // ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à: ‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÅ‡∏ï‡∏Å‡πÉ‡∏´‡∏ç‡πà/‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô render ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏™‡∏±‡∏à‡∏à‡∏≤)
      { name: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à', unit: '', category: 'packaging', icon:'üì¶', orderOnly:true },

      { name: '‡∏ï‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏ö', unit: '', category: 'packaging', icon:'üì¶', orderOnly:true },

      // ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î (‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°)
      { name: '‡∏ñ‡∏∏‡∏á‡∏Ç‡∏¢‡∏∞', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà‡πÅ‡∏´‡πâ‡∏á', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏ô', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ü‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏ô', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true },
      { name: '‡∏´‡∏°‡∏ß‡∏Å‡∏Ñ‡∏•‡∏∏‡∏°‡∏ú‡∏°', unit: '', category: 'cleaning', icon:'üßπ', orderOnly:true }
    ];

    // ---------- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏®‡∏©" ----------
    const FRACTIONAL_ITEMS = new Set([
      '‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà',
      '‡∏ã‡∏≠‡∏™‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°',
      '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡πÄ‡∏à‡∏µ‡∏¢‡∏ß',
      '‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏à‡∏Å',
      '‡πÉ‡∏ö‡∏û‡∏≤‡∏™‡πÄ‡∏•‡πà‡∏¢‡πå',
      '‡∏Å‡∏•‡πà‡∏≠‡∏á 26 oz', '‡∏Å‡∏•‡πà‡∏≠‡∏á 32 oz',
      '‡∏ñ‡∏∏‡∏á‡∏ã‡∏µ‡∏• 7√ó10', '‡∏ñ‡∏∏‡∏á‡∏ã‡∏µ‡∏• 9√ó11.5',
      '‡∏ñ‡∏∏‡∏á‡∏´‡∏¥‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å 6√ó14', '‡∏ñ‡∏∏‡∏á‡∏´‡∏¥‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å 8√ó16',
      '‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°', '‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡πÅ‡∏ã‡πà‡∏ö'
    ]);
    function isFractional(item){ return item.unit === '‡πÅ‡∏Å‡∏•‡∏•‡∏≠‡∏ô' || FRACTIONAL_ITEMS.has(item.name); }

    // ---------- Flow ----------
    function selectBranch(branch){
      currentBranch = branch;
      document.getElementById('selectedBranch').textContent = branch;
      showScreen('modeScreen');
    }

    function selectMode(mode){
      currentMode = mode;
      document.getElementById('modeText').textContent = mode === 'open' ? 'üîì ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô' : 'üåô ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô';
      loadStockItems();
      showScreen('stockScreen');
    }

    function loadStockItems(){
      const items = currentMode === 'open' ? openModeItems : closeModeItems;
      const container = document.getElementById('stockItems');
      container.innerHTML = '';
      stockData = {};
      orderRequests = {};
      customOrders = [];

      if(currentMode === 'close'){
        const categories = {
          fresh:     { name:'‡∏´‡∏°‡∏ß‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏™‡∏î',               items:[], icon:'ü•¨' },
          seasoning: { name:'‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á',               items:[], icon:'üßÇ' },
          packaging: { name:'‡∏´‡∏°‡∏ß‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå + ‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°/‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°', items:[], icon:'üì¶' },
          cleaning:  { name:'‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î',      items:[], icon:'üßπ' }
        };

        items.forEach(item=>{
          // ‡πÅ‡∏ï‡∏Å "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à" ‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡∏ç‡πà/‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏™‡∏±‡∏à‡∏à‡∏≤
          if(item.name==='‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à' && currentBranch==='‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏™‡∏±‡∏à‡∏à‡∏≤'){
            categories[item.category].items.push(
              { name:'‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÉ‡∏´‡∏ç‡πà)', unit:'', category:'packaging', icon:'üì¶', orderOnly:true },
              { name:'‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÄ‡∏•‡πá‡∏Å)',  unit:'', category:'packaging', icon:'üì¶', orderOnly:true }
            );
          } else {
            categories[item.category].items.push(item);
          }
        });

        Object.keys(categories).forEach(key=>{
          const cat = categories[key];
          if(cat.items.length>0){
            const group = document.createElement('div');
            group.className='mb-6';
            group.innerHTML = `
              <div class="flex items-center mb-4">
                <span class="text-2xl mr-2">${cat.icon}</span>
                <h3 class="text-lg font-semibold text-gray-800">${cat.name}</h3>
              </div>`;
            cat.items.forEach(it=> group.appendChild(createItemElement(it)));
            container.appendChild(group);
          }
        });

        // ‡∏™‡πà‡∏ß‡∏ô "‡∏™‡∏±‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡πÄ‡∏û‡∏¥‡πà‡∏°"
        const customDiv = document.createElement('div');
        customDiv.className='mb-6';
        customDiv.innerHTML = `
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-2">üìù</span>
            <h3 class="text-lg font-semibold text-gray-800">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ‡πÄ‡∏û‡∏¥‡πà‡∏°</h3>
          </div>
          <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
            <div class="space-y-3">
              <div class="flex items-center space-x-3">
                <input type="text" id="customItemName"
                  class="flex-1 px-3 py-2 border border-gray-300 rounded-lg"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏û‡∏™‡∏≠‡∏¥‡∏ó, ‡∏™‡∏Å‡πä‡∏≠‡∏ï‡πÄ‡∏ó‡∏õ, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
                  onkeypress="if(event.key==='Enter') addCustomOrder()">
                <button onclick="addCustomOrder()"
                  class="bg-green-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors">
                  ‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>
              </div>
              <div id="customOrdersList" class="space-y-2"></div>
            </div>
          </div>`;
        container.appendChild(customDiv);
      } else {
        // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÜ
        items.forEach(it=> container.appendChild(createItemElement(it)));
      }

      updateProgress();
    }

    // ---------- Render item ----------
    function createItemElement(item){
      const div = document.createElement('div');
      div.className='bg-white rounded-xl p-4 mb-3 shadow-sm border border-gray-100';

      // ‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
      if(item.orderOnly){
        div.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <h4 class="font-medium text-gray-800">${item.name}</h4>
              <p class="text-sm text-gray-500">‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</p>
            </div>
            <label class="flex items-center">
              <input type="checkbox" class="w-5 h-5 text-orange-500 rounded"
                     onchange="toggleOrderRequest('${item.name}', this.checked, this)">
              <span class="ml-2 text-sm text-gray-600">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
            </label>
          </div>`;
        return div;
      }

      // ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏®‡∏©" (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° 0-6 + 1/4 1/2 3/4)
      if(isFractional(item)){
        div.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex-1"><h4 class="font-medium text-gray-800">${item.name}</h4></div>
            <div class="flex items-center space-x-3">
              <div class="flex items-center space-x-2">
                <select class="w-16 px-2 py-2 border border-gray-300 rounded-lg text-center font-medium"
                        onchange="updateFractionalStock('${item.name}')">
                  ${Array.from({length:7},(_,i)=>`<option value="${i}">${i}</option>`).join('')}
                </select>
                <select class="w-16 px-2 py-2 border border-gray-300 rounded-lg text-center font-medium"
                        onchange="updateFractionalStock('${item.name}')">
                  <option value="">-</option>
                  <option value="1/4">1/4</option>
                  <option value="1/2">1/2</option>
                  <option value="3/4">3/4</option>
                </select>
                <span class="text-sm text-gray-600">${item.unit||''}</span>
              </div>
              ${currentMode==='close' ? `
                <button onclick="requestOrder('${item.name}')"
                  class="bg-orange-500 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors">
                  ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>` : ''}
            </div>
          </div>`;
        return div;
      }

      // ‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç (0-6)
      div.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="flex-1"><h4 class="font-medium text-gray-800">${item.name}</h4></div>
          <div class="flex items-center space-x-3">
            <div class="flex items-center space-x-2">
              <input type="number" class="w-20 px-3 py-2 border border-gray-300 rounded-lg text-center font-medium"
                     placeholder="0" min="0" max="6"
                     onchange="updateStock('${item.name}', Math.min(Number(this.value||0),6))">
              <span class="text-sm text-gray-600">${item.unit||''}</span>
            </div>
            ${currentMode==='close' ? `
              <button onclick="requestOrder('${item.name}')"
                class="bg-orange-500 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors">
                ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°
              </button>` : ''}
          </div>
        </div>`;
      return div;
    }

    // ---------- Update handlers ----------
    function updateStock(itemName,val){
      stockData[itemName] = (val ?? '') === '' ? '' : String(val);
      updateProgress();
    }

    function updateFractionalStock(itemName){
      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å select ‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏ô‡∏µ‡πâ (‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å attribute onchange ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ item)
      const selects = document.querySelectorAll(`select[onchange*="${CSS.escape(itemName)}"]`);
      if(selects.length===2){
        const whole = selects[0].value;  // 0..6
        const frac  = selects[1].value;  // '', '1/4','1/2','3/4'
        let combined = whole;
        if(frac && whole!=='0') combined = `${whole} ${frac}`;
        else if(frac && whole==='0') combined = frac;
        stockData[itemName] = combined || '';
        updateProgress();
      }
    }
    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å
    function updateNoodleStock(n){ updateFractionalStock(n); }
    function updateGallonStock(n){ updateFractionalStock(n); }

    // ---------- ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° ----------
    function toggleOrderRequest(itemName,checked,checkbox){
      if(checked){
        currentConfirmItem = itemName;
        document.getElementById('confirmItemName').textContent = itemName;
        document.getElementById('confirmModal').classList.remove('hidden');
        window.currentCheckbox = checkbox;
      }else{
        delete orderRequests[itemName];
        updateProgress();
      }
    }
    function requestOrder(itemName){
      currentConfirmItem = itemName;
      document.getElementById('confirmItemName').textContent = itemName;
      document.getElementById('confirmModal').classList.remove('hidden');
    }
    function confirmOrder(){
      orderRequests[currentConfirmItem] = true;
      closeModal();
      updateProgress();
    }
    function closeModal(){
      document.getElementById('confirmModal').classList.add('hidden');
      if(window.currentCheckbox && !orderRequests[currentConfirmItem]){
        window.currentCheckbox.checked = false;
      }
      currentConfirmItem = '';
      window.currentCheckbox = null;
    }

    // ---------- Progress ----------
    function updateProgress(){
      const items = currentMode==='open' ? openModeItems : closeModeItems;
      let completed = 0;
      items.forEach(item=>{
        if(item.orderOnly){
          // ‡∏ô‡∏±‡∏ö‡∏ß‡πà‡∏≤ ‚Äú‡∏ú‡πà‡∏≤‡∏ô‚Äù ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡πä‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πÄ‡∏Å‡∏£‡∏™‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á
          completed++;
        }else{
          if(stockData[item.name] && stockData[item.name] !== '') completed++;
        }
      });
      const pct = Math.round((completed / items.length) * 100);
      document.getElementById('progressText').textContent = pct + '%';
      document.getElementById('progressBar').style.width = pct + '%';
    }

    // ---------- Save / Summary ----------
    function saveStock(){
      if(currentMode==='open'){ confirmSaveStock(); }
      else { showOrderSummary(); showScreen('summaryScreen'); }
    }

    function showOrderSummary(){
      const container = document.getElementById('orderSummaryList');
      container.innerHTML = '';
      const allOrders = Object.keys(orderRequests).filter(k=> orderRequests[k]);
      if(allOrders.length===0){
        container.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">üìù</div>
            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</p>
          </div>`;
      }else{
        allOrders.forEach((name,idx)=>{
          const row = document.createElement('div');
          row.className='flex items-center justify-between p-3 border-b border-gray-100 last:border-b-0';
          row.innerHTML = `
            <div class="flex items-center">
              <span class="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-sm font-medium mr-3">${idx+1}</span>
              <span class="font-medium text-gray-800">${name}</span>
            </div>
            <span class="text-green-600 font-medium">‚úì ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</span>`;
          container.appendChild(row);
        });
      }
    }

    async function confirmSaveStock(){
      const now = new Date();
      const payload = {
        branch: currentBranch,
        mode: currentMode,
        date: now.toLocaleDateString('th-TH'),
        time: now.toLocaleTimeString('th-TH'),
        progress: parseInt(document.getElementById('progressText').textContent)||0,
        orders: Object.keys(orderRequests).filter(k=>orderRequests[k]===true),
      };
      // ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ Netlify Function ‚Üí Telegram
      try{
        await fetch('/.netlify/functions/telegram', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      }catch(e){ console.error('Telegram error:', e); }

      const report = { ...payload, stockData, customOrders };
      console.log('Stock Report:', report);
      document.getElementById('successModal').classList.remove('hidden');
    }

    // ---------- Custom orders ----------
    function addCustomOrder(){
      const input = document.getElementById('customItemName');
      const name = (input.value||'').trim();
      if(!name){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'); return; }
      if(customOrders.some(o=>o.name===name)){ alert('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß'); return; }
      const obj = { id: Date.now(), name };
      customOrders.push(obj);
      orderRequests[name] = true;
      input.value = '';
      updateCustomOrdersList();
    }
    function updateCustomOrdersList(){
      const container = document.getElementById('customOrdersList');
      if(!container) return;
      container.innerHTML = '';
      customOrders.forEach(order=>{
        const row = document.createElement('div');
        row.className='flex items-center justify-between bg-green-50 p-3 rounded-lg border border-green-200';
        row.innerHTML=`
          <div class="flex-1"><span class="font-medium text-green-800">${order.name}</span></div>
          <button onclick="removeCustomOrder(${order.id})" class="text-red-500 hover:text-red-700 text-sm font-medium">‡∏•‡∏ö</button>`;
        container.appendChild(row);
      });
    }
    function removeCustomOrder(id){
      const i = customOrders.findIndex(o=>o.id===id);
      if(i!==-1){
        const name = customOrders[i].name;
        delete orderRequests[name];
        customOrders.splice(i,1);
        updateCustomOrdersList();
      }
    }

    // ---------- Utils ----------
    function resetApp(){
      currentBranch=''; currentMode=''; stockData={}; orderRequests={}; customOrders=[];
      document.getElementById('successModal').classList.add('hidden');
      showScreen('branchScreen');
    }
    function showScreen(id){
      ['branchScreen','modeScreen','stockScreen','summaryScreen'].forEach(s=>document.getElementById(s).classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }
    function goBack(id){ showScreen(id); }

    // Init
    showScreen('branchScreen');
  </script>
</body>
</html>
